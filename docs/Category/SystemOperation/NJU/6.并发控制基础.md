## 0x01 互斥问题和 Peterson 算法
### 互斥

**插入 “神秘代码”，使得所有其他 “神秘代码” 都不能并发**

``` c hl_lines="3-4"
void Tsum() {
  stop_the_world();
  // 临界区 critical section
  sum++;
  resume_the_world();
}
```

Stop the world 真的是可能的:

- Java 有 “stop the world GC”
- 单个处理器可以关闭中断
- 多个处理器也可以发送核间中断

### 失败的尝试

``` c
int locked = UNLOCK;

void critical_section() {
retry:
  if (locked != UNLOCK) {
    goto retry;
  }
  locked = LOCK;

  // critical section

  locked = UNLOCK;
}
```

==并发程序不能保证 load + store 的原子性==

### 更严肃地尝试：确定假设、设计算法




## 0x02 Peterson 算法的正确性和模型检验

## 0x03 Peterson 算法在现代多处理器系统上的实现

## 0x04 实现并发控制的硬件和编译器机制



